import{f as R,u as K,e as O,r as o,s as l,j as e,a as W,b as j,h as A}from"./index-24deb802.js";import{I as h}from"./input-e93ef1bc.js";import{L as x}from"./label-35db8bb0.js";import{C as D,a as L,b as T,c as V,d as $,e as X}from"./card-f73a9eb6.js";import{m as b}from"./motion-9631c0a3.js";import{A as G}from"./arrow-left-3ba35926.js";import{F as J}from"./file-text-ea41be1c.js";import{T as Q}from"./trash-2-64b777aa.js";const Z=R("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),ee=R("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]),ce=()=>{const{user:s,profile:m,fetchProfile:N,loading:y}=K(),{toast:r}=O(),[w,C]=o.useState(""),[U,_]=o.useState(null),[p,u]=o.useState(!1),[ae,F]=o.useState(null),[E,P]=o.useState(!1),[k,M]=o.useState([]),[z,I]=o.useState(!0);o.useEffect(()=>{m&&(C(m.full_name||""),_(m.avatar_url||null)),s&&v(),y||I(!1)},[m,s,y]);const v=async()=>{if(!s)return;const{data:a,error:t}=await l.from("resumes").select("id, file_name, uploaded_at, storage_path").eq("candidate_id",s.id).order("uploaded_at",{ascending:!1});t?r({title:"Error fetching resumes",description:t.message,variant:"destructive"}):M(a||[])},B=async a=>{a.preventDefault(),u(!0);const t={id:s.id,full_name:w,updated_at:new Date},{error:i}=await l.from("profiles").upsert(t);i?r({title:"Profile Update Failed",description:i.message,variant:"destructive"}):(r({title:"Profile Updated",description:"Your profile has been successfully updated."}),N(s.id)),u(!1)},Y=async a=>{try{if(u(!0),!a.target.files||a.target.files.length===0)throw new Error("You must select an image to upload.");const t=a.target.files[0],i=t.name.split(".").pop(),f=`avatars/${`${s.id}-${Math.random()}.${i}`}`;let{error:n}=await l.storage.from("avatars").upload(f,t);if(n)throw n;const{data:{publicUrl:c}}=l.storage.from("avatars").getPublicUrl(f),g={id:s.id,avatar_url:c,updated_at:new Date};let{error:S}=await l.from("profiles").upsert(g);if(S)throw S;_(c),N(s.id),r({title:"Avatar Updated",description:"Your avatar has been changed."})}catch(t){r({title:"Avatar Upload Failed",description:t.message,variant:"destructive"})}finally{u(!1)}},q=async a=>{if(!a.target.files||a.target.files.length===0){r({title:"No file selected",description:"Please select a CV to upload.",variant:"destructive"});return}const t=a.target.files[0];if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)){r({title:"Invalid File Type",description:"Please upload a PDF or Word document.",variant:"destructive"});return}if(t.size>5*1024*1024){r({title:"File Too Large",description:"CV file size should not exceed 5MB.",variant:"destructive"});return}F(t);try{P(!0);const d=t.name.split(".").pop(),f=`cv-${s.id}-${Date.now()}.${d}`,n=`${s.id}/${f}`,{error:c}=await l.storage.from("resumes").upload(n,t);if(c)throw c;const{error:g}=await l.from("resumes").insert({candidate_id:s.id,file_name:t.name,storage_path:n,file_type:t.type});if(g)throw g;r({title:"CV Uploaded",description:`${t.name} has been successfully uploaded.`}),F(null),document.getElementById("cv-upload-input").value="",v()}catch(d){r({title:"CV Upload Failed",description:d.message,variant:"destructive"})}finally{P(!1)}},H=async(a,t)=>{if(window.confirm("Are you sure you want to delete this resume?"))try{const{error:i}=await l.storage.from("resumes").remove([t]);if(i)throw i;const{error:d}=await l.from("resumes").delete().eq("id",a);if(d)throw d;r({title:"Resume Deleted",description:"The resume has been successfully deleted."}),v()}catch(i){r({title:"Error Deleting Resume",description:i.message,variant:"destructive"})}};return z?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white",children:e.jsx("p",{children:"Loading profile..."})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-800 via-gray-900 to-black text-white p-6",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs(b.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-8",children:[e.jsx(W,{to:"/candidate/dashboard",children:e.jsxs(j,{variant:"ghost",className:"text-indigo-300 hover:bg-indigo-700/30 hover:text-indigo-100 mb-4",children:[e.jsx(G,{className:"mr-2 h-5 w-5"})," Back to Dashboard"]})}),e.jsx("h1",{className:"text-4xl font-bold text-indigo-300",children:"Manage Your Profile"}),e.jsx("p",{className:"text-lg text-gray-400",children:"Keep your information and CV up-to-date."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx(b.div,{className:"lg:col-span-2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1},children:e.jsxs(D,{className:"bg-gray-800/70 backdrop-blur-sm border-gray-700",children:[e.jsxs(L,{children:[e.jsxs(T,{className:"text-2xl text-indigo-300 flex items-center",children:[e.jsx(A,{className:"w-8 h-8 mr-3 text-purple-400"})," Personal Information"]}),e.jsx(V,{className:"text-gray-400",children:"Update your name and avatar."})]}),e.jsxs("form",{onSubmit:B,children:[e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[U?e.jsx("img-replace",{src:U,alt:"User Avatar",className:"w-32 h-32 rounded-full object-cover border-4 border-indigo-500 shadow-lg"}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center border-4 border-indigo-500",children:e.jsx(A,{className:"w-20 h-20 text-gray-500"})}),e.jsx(x,{htmlFor:"avatar-upload-input",className:"cursor-pointer text-indigo-400 hover:text-indigo-300 transition-colors",children:p?"Uploading...":"Change Avatar"}),e.jsx(h,{id:"avatar-upload-input",type:"file",accept:"image/*",onChange:Y,disabled:p,className:"hidden"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"fullName",className:"text-gray-300",children:"Full Name"}),e.jsx(h,{id:"fullName",type:"text",value:w,onChange:a=>C(a.target.value),className:"bg-gray-700 border-gray-600 focus:border-indigo-500 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"email",className:"text-gray-300",children:"Email (Cannot be changed)"}),e.jsx(h,{id:"email",type:"email",value:(s==null?void 0:s.email)||"",disabled:!0,className:"bg-gray-700/50 border-gray-600 cursor-not-allowed"})]})]}),e.jsx(X,{children:e.jsxs(j,{type:"submit",disabled:p||y,className:"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700",children:[e.jsx(Z,{className:"w-5 h-5 mr-2"})," ",p?"Saving...":"Save Changes"]})})]})]})}),e.jsx(b.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},children:e.jsxs(D,{className:"bg-gray-800/70 backdrop-blur-sm border-gray-700",children:[e.jsxs(L,{children:[e.jsxs(T,{className:"text-2xl text-indigo-300 flex items-center",children:[e.jsx(ee,{className:"w-8 h-8 mr-3 text-purple-400"})," Manage CV / Resume"]}),e.jsx(V,{className:"text-gray-400",children:"Upload or update your CV (PDF or DOCX, max 5MB)."})]}),e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"cv-upload-input",className:"text-gray-300",children:"Upload New CV"}),e.jsx(h,{id:"cv-upload-input",type:"file",accept:".pdf,.doc,.docx",onChange:q,disabled:E,className:"bg-gray-700 border-gray-600 file:text-indigo-300 file:bg-gray-600 file:border-0 file:rounded file:px-3 file:py-1.5 file:mr-3 hover:file:bg-indigo-500"}),E&&e.jsx("p",{className:"text-sm text-indigo-400 mt-2",children:"Uploading CV..."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-300 mb-3",children:"Uploaded Resumes:"}),k.length>0?e.jsx("ul",{className:"space-y-3",children:k.map(a=>e.jsxs("li",{className:"flex justify-between items-center p-3 bg-gray-700/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"w-5 h-5 text-indigo-400"}),e.jsx("a",{href:l.storage.from("resumes").getPublicUrl(a.storage_path).data.publicUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-indigo-300 hover:underline truncate max-w-[150px] sm:max-w-[200px]",title:a.file_name,children:a.file_name})]}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>H(a.id,a.storage_path),className:"text-red-400 hover:text-red-300",children:e.jsx(Q,{className:"w-4 h-4"})})]},a.id))}):e.jsx("p",{className:"text-sm text-gray-500",children:"No resumes uploaded yet."})]})]})]})})]})]})})};export{ce as default};
